package BSML.behavior;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SConceptOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;

public class BSMLHelper {
  public static SNode getArena(SNode trans) {
    SNode arena = getLowestCommonAncester(ITransition__BehaviorDescriptor.source_id5zmpEki_aET.invoke(trans), ITransition__BehaviorDescriptor.target_id5zmpEki_aEA.invoke(trans));
    if (SNodeOperations.isInstanceOf(arena, MetaAdapterFactory.getInterfaceConcept(0x181cb8f23d5e4aa9L, 0xb8cd2e496087f7c8L, 0x58d666a5129468c8L, "BSML.structure.IRegion"))) {
      return SNodeOperations.cast(arena, MetaAdapterFactory.getInterfaceConcept(0x181cb8f23d5e4aa9L, 0xb8cd2e496087f7c8L, 0x58d666a5129468c8L, "BSML.structure.IRegion"));
    }
    return SNodeOperations.getNodeAncestor(arena, MetaAdapterFactory.getInterfaceConcept(0x181cb8f23d5e4aa9L, 0xb8cd2e496087f7c8L, 0x58d666a5129468c8L, "BSML.structure.IRegion"), false, false);
  }
  public static SNode getLowestCommonAncester(SNode r1, SNode r2) {
    SNode scope = r1;
    while (!((ListSequence.fromList(SNodeOperations.getNodeDescendants(scope, MetaAdapterFactory.getInterfaceConcept(0x181cb8f23d5e4aa9L, 0xb8cd2e496087f7c8L, 0x58d666a5129468cbL, "BSML.structure.ISMNamedElement"), true, new SAbstractConcept[]{})).contains(r2)))) {
      scope = SNodeOperations.getNodeAncestor(scope, MetaAdapterFactory.getInterfaceConcept(0x181cb8f23d5e4aa9L, 0xb8cd2e496087f7c8L, 0x58d666a5129468cbL, "BSML.structure.ISMNamedElement"), false, false);
    }
    return scope;
  }
  public static boolean orthogonal(SNode r1, SNode r2) {
    if (r1 == r2 || ListSequence.fromList(SNodeOperations.getNodeAncestors(r1, null, false)).contains(r2) || ListSequence.fromList(SNodeOperations.getNodeAncestors(r2, null, false)).contains(r1) || SNodeOperations.isInstanceOf(getLowestCommonAncester(r1, r2), MetaAdapterFactory.getInterfaceConcept(0x181cb8f23d5e4aa9L, 0xb8cd2e496087f7c8L, 0x58d666a5129468c8L, "BSML.structure.IRegion"))) {
      return false;
    }
    return true;
  }
  public static SNode getScope(SNode trans) {
    return getLowestCommonAncester(ITransition__BehaviorDescriptor.source_id5zmpEki_aET.invoke(trans), ITransition__BehaviorDescriptor.target_id5zmpEki_aEA.invoke(trans));
  }
  public static boolean interrupt(SNode interrupter, SNode interruptee) {
    if (orthogonal(SNodeOperations.getNodeAncestor(ITransition__BehaviorDescriptor.source_id5zmpEki_aET.invoke(interruptee), MetaAdapterFactory.getInterfaceConcept(0x181cb8f23d5e4aa9L, 0xb8cd2e496087f7c8L, 0x58d666a5129468c8L, "BSML.structure.IRegion"), false, false), SNodeOperations.getNodeAncestor(ITransition__BehaviorDescriptor.source_id5zmpEki_aET.invoke(interrupter), MetaAdapterFactory.getInterfaceConcept(0x181cb8f23d5e4aa9L, 0xb8cd2e496087f7c8L, 0x58d666a5129468c8L, "BSML.structure.IRegion"), false, false))) {
      if (orthogonal(SNodeOperations.getNodeAncestor(ITransition__BehaviorDescriptor.target_id5zmpEki_aEA.invoke(interruptee), MetaAdapterFactory.getInterfaceConcept(0x181cb8f23d5e4aa9L, 0xb8cd2e496087f7c8L, 0x58d666a5129468c8L, "BSML.structure.IRegion"), false, false), SNodeOperations.getNodeAncestor(ITransition__BehaviorDescriptor.source_id5zmpEki_aET.invoke(interrupter), MetaAdapterFactory.getInterfaceConcept(0x181cb8f23d5e4aa9L, 0xb8cd2e496087f7c8L, 0x58d666a5129468c8L, "BSML.structure.IRegion"), false, false))) {
        if (!((orthogonal(SNodeOperations.getNodeAncestor(ITransition__BehaviorDescriptor.target_id5zmpEki_aEA.invoke(interrupter), MetaAdapterFactory.getInterfaceConcept(0x181cb8f23d5e4aa9L, 0xb8cd2e496087f7c8L, 0x58d666a5129468c8L, "BSML.structure.IRegion"), false, false), SNodeOperations.getNodeAncestor(ITransition__BehaviorDescriptor.source_id5zmpEki_aET.invoke(interrupter), MetaAdapterFactory.getInterfaceConcept(0x181cb8f23d5e4aa9L, 0xb8cd2e496087f7c8L, 0x58d666a5129468c8L, "BSML.structure.IRegion"), false, false)))) && !((orthogonal(SNodeOperations.getNodeAncestor(ITransition__BehaviorDescriptor.target_id5zmpEki_aEA.invoke(interrupter), MetaAdapterFactory.getInterfaceConcept(0x181cb8f23d5e4aa9L, 0xb8cd2e496087f7c8L, 0x58d666a5129468c8L, "BSML.structure.IRegion"), false, false), SNodeOperations.getNodeAncestor(ITransition__BehaviorDescriptor.source_id5zmpEki_aET.invoke(interruptee), MetaAdapterFactory.getInterfaceConcept(0x181cb8f23d5e4aa9L, 0xb8cd2e496087f7c8L, 0x58d666a5129468c8L, "BSML.structure.IRegion"), false, false))))) {
          return true;
        }
      } else if (!((orthogonal(SNodeOperations.getNodeAncestor(ITransition__BehaviorDescriptor.target_id5zmpEki_aEA.invoke(interrupter), MetaAdapterFactory.getInterfaceConcept(0x181cb8f23d5e4aa9L, 0xb8cd2e496087f7c8L, 0x58d666a5129468c8L, "BSML.structure.IRegion"), false, false), SNodeOperations.getNodeAncestor(ITransition__BehaviorDescriptor.source_id5zmpEki_aET.invoke(interrupter), MetaAdapterFactory.getInterfaceConcept(0x181cb8f23d5e4aa9L, 0xb8cd2e496087f7c8L, 0x58d666a5129468c8L, "BSML.structure.IRegion"), false, false)))) && !((orthogonal(SNodeOperations.getNodeAncestor(ITransition__BehaviorDescriptor.target_id5zmpEki_aEA.invoke(interrupter), MetaAdapterFactory.getInterfaceConcept(0x181cb8f23d5e4aa9L, 0xb8cd2e496087f7c8L, 0x58d666a5129468c8L, "BSML.structure.IRegion"), false, false), SNodeOperations.getNodeAncestor(ITransition__BehaviorDescriptor.source_id5zmpEki_aET.invoke(interruptee), MetaAdapterFactory.getInterfaceConcept(0x181cb8f23d5e4aa9L, 0xb8cd2e496087f7c8L, 0x58d666a5129468c8L, "BSML.structure.IRegion"), false, false)))) && !((orthogonal(SNodeOperations.getNodeAncestor(ITransition__BehaviorDescriptor.target_id5zmpEki_aEA.invoke(interruptee), MetaAdapterFactory.getInterfaceConcept(0x181cb8f23d5e4aa9L, 0xb8cd2e496087f7c8L, 0x58d666a5129468c8L, "BSML.structure.IRegion"), false, false), SNodeOperations.getNodeAncestor(ITransition__BehaviorDescriptor.source_id5zmpEki_aET.invoke(interrupter), MetaAdapterFactory.getInterfaceConcept(0x181cb8f23d5e4aa9L, 0xb8cd2e496087f7c8L, 0x58d666a5129468c8L, "BSML.structure.IRegion"), false, false)))) && !((orthogonal(SNodeOperations.getNodeAncestor(ITransition__BehaviorDescriptor.target_id5zmpEki_aEA.invoke(interruptee), MetaAdapterFactory.getInterfaceConcept(0x181cb8f23d5e4aa9L, 0xb8cd2e496087f7c8L, 0x58d666a5129468c8L, "BSML.structure.IRegion"), false, false), SNodeOperations.getNodeAncestor(ITransition__BehaviorDescriptor.source_id5zmpEki_aET.invoke(interruptee), MetaAdapterFactory.getInterfaceConcept(0x181cb8f23d5e4aa9L, 0xb8cd2e496087f7c8L, 0x58d666a5129468c8L, "BSML.structure.IRegion"), false, false))))) {
        if (ListSequence.fromList(SNodeOperations.getNodeAncestors(ITransition__BehaviorDescriptor.target_id5zmpEki_aEA.invoke(interrupter), null, false)).contains(ITransition__BehaviorDescriptor.target_id5zmpEki_aEA.invoke(interruptee))) {
          return true;
        }
      }
    }
    return false;
  }
  public static String getArena(String sourceRegion, String targetRegion) {
    int capacity = Math.min(sourceRegion.length(), targetRegion.length());
    StringBuffer ret = new StringBuffer(capacity);
    int lastDot = -1;
    for (int i = 0; i < capacity; i++) {
      if (sourceRegion.charAt(i) == targetRegion.charAt(i)) {
        if (sourceRegion.charAt(i) == '.') {
          lastDot = i;
        }
        ret.append(sourceRegion.charAt(i));
      } else {
        if (lastDot != -1) {
          ret.setLength(i);
        }
        return ret.toString();
      }
    }
    return ret.toString();
  }
  public static SNode convertArrayTypeToPointerType(SNode t) {
    SNode ret = SConceptOperations.createNewNode(SNodeOperations.asInstanceConcept(MetaAdapterFactory.getConcept(0x3bf5377ae9044dedL, 0x97545a516023bfaaL, 0x3e0cae5e366d630L, "com.mbeddr.core.pointers.structure.PointerType")));
    SPropertyOperations.set(ret, MetaAdapterFactory.getProperty(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a1ba36L, 0x28d183d9a4fae02fL, "volatile"), "" + (SPropertyOperations.getBoolean(t, MetaAdapterFactory.getProperty(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a1ba36L, 0x28d183d9a4fae02fL, "volatile"))));
    SPropertyOperations.set(ret, MetaAdapterFactory.getProperty(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a1ba36L, 0x28d183d9a4cc7da8L, "const"), "" + (SPropertyOperations.getBoolean(t, MetaAdapterFactory.getProperty(0x61c69711ed614850L, 0x81d97714ff227fb0L, 0x7af69e2e83a1ba36L, 0x28d183d9a4cc7da8L, "const"))));
    if (SNodeOperations.isInstanceOf(SLinkOperations.getTarget(t, MetaAdapterFactory.getContainmentLink(0xa9d696470840491eL, 0xbf392eb0805d2011L, 0x6bbcdccef5e46755L, 0x6bbcdccef5e46756L, "baseType")), MetaAdapterFactory.getConcept(0x3bf5377ae9044dedL, 0x97545a516023bfaaL, 0x4ed16d83a1d30c81L, "com.mbeddr.core.pointers.structure.ArrayType"))) {
      SLinkOperations.setTarget(ret, MetaAdapterFactory.getContainmentLink(0xa9d696470840491eL, 0xbf392eb0805d2011L, 0x6bbcdccef5e46755L, 0x6bbcdccef5e46756L, "baseType"), convertArrayTypeToPointerType(((SNode) SLinkOperations.getTarget(t, MetaAdapterFactory.getContainmentLink(0xa9d696470840491eL, 0xbf392eb0805d2011L, 0x6bbcdccef5e46755L, 0x6bbcdccef5e46756L, "baseType")))));
    } else {
      SLinkOperations.setTarget(ret, MetaAdapterFactory.getContainmentLink(0xa9d696470840491eL, 0xbf392eb0805d2011L, 0x6bbcdccef5e46755L, 0x6bbcdccef5e46756L, "baseType"), SLinkOperations.getTarget(t, MetaAdapterFactory.getContainmentLink(0xa9d696470840491eL, 0xbf392eb0805d2011L, 0x6bbcdccef5e46755L, 0x6bbcdccef5e46756L, "baseType")));
    }
    return ret;
  }
}
